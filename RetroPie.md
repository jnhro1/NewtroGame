# 레트로파이 구현하기

## 1. 회로 설계  
![RetroPie7](./image/RetroPie7.jpg)  
* 1, 2, 3, 4, 5, 6번 포트에 버튼을 연결한다.  
* Up, Down, Right, Left에 조이스틱을 연결한다.  
* usb port에 라즈베리파이와 연결이 가능한 usb선을 연결한다.  
* 버튼 하나에 MODE에 연결하여 버튼의 작동하는데 MODE를 변경하여 준다.  

## 2. 레트로 파이 설치하기  
* https://retropie.org.uk/download/에 들어가서 레트로 파이 os를 설치한다.  
* 자신이 가지고 있는 라즈베리파이 버전에 맞춰서 다운로드 받는다.  
-> 조하롭게 팀은 라즈베리파이 3을 가지고 있기 때문에 Raspberry Pi 2/3을 다운로드 받아 설치를 하였다.  
* os를 재설치하는 것이기 때문에 https://sd-card-formatter.kr.uptodown.com/windows 에 들어가서 sd카드를 포맷하여 기존의 운영체제 및 다른 작업들을 한 것을 지운다.  
* SD Card Formatter를 실행한 후 해당 디바이스를 설치한 후 퀵 포맷을 누르고 포맷을 시작한다.  
* 포맷을 한 후 https://www.balena.io/etcher/ 에 들어가서 라즈베리파이에 레트로 파이 os를 넣어줄 프로그램을 본인의 컴퓨터에 맞는 파일을 다운받는다.  
-> 조하롭게 팀은 64비트 운영체제에 맞는 프로그램을 다운받았다.  
* balena Etcher 프로그램을 실행한 후 retropie-4.5.1-rpi2_rpi3.img 파일을 알맞은 디바이스에 넣은 후 Flash를 누른다.  
* os 다운로드가 완료되면 SD Card를 라즈베리파이에 꽂아서 부팅을 한다.  

## 3. 레트로 파이 설정  
### 3-1. 키 설정  
* 부팅을 하게 되면 조이스틱이 연결되어 있으면 1개의 연결된 조이스틱이 있으며 버튼 하나를 길게 누르고 그렇지 않을 경우 키보드를 연결시켜 F4를 누른다.  
-> 조하롭게 팀은 조이스틱이 연결되어 있기 때문에 하나의 버튼을 길게 누른다.  
* 버튼을 누르게 되면 버튼 키를 설정할 수 있는 configuration창이 나타난다. 여기서 원하는 키에 맞게 설정을 한다.  
* 버튼 설정은 원하는 방향에 키를 한번씩 누르며 키 설정을 하지 않을 것들은 아무 버튼을 길게 눌러주면 다음으로 넘어간다. (키 하나당 버튼 하나이다.)  
* 버튼을 설정할 때 괄호로 쳐져있는 A, B, X, Y를 잘 기억해야한다. A버튼은 확인 버튼으로 사용된다.  
### 3-2. 레트로 파이 환경 설정  
* 조이스틱을 사용하여 레트로 파이 라고 되어있는 화면이 나올 때 까지 조이스틱으로 넘겨준다.  
(13개의 게임이 가능하다고 되어있는데 이것은 게임이 13개가 아니라 13개의 항목이 있다는 것을 의미하며 게임은 따로 넣어야한다.)  
* 레트로 파이 화면에서 A버튼으로 설정한 키 버튼을 눌러서 설정 메뉴로 들어간다.  
* 설정 메뉴에 들어가게 되면 13가지의 메뉴가 있으며 처음 오디오 설정을 한다.  
#### 3-2-1 소리 설정  
* 설정에 Audio 창에서 A버튼을 누른다.  
* 5가지 설정 창에서 4번 설정에 들어간다.  
* 4번 설정에 들어가게 되면 내부 오디오 볼륨이 설정 가능하며 조이스틱 위, 아래키로 설정이 가능하다.  
-> 조하롭게 팀은 스마트 미러를 활용할 예정이기 때문에 내부 소리를 0으로 설정을 하였다.  
* 볼륨 창에서 빠져나오기 위해서는 라즈베리 파이에 키보드를 연결하여 esc키를 눌러 이전 화면으로 빠져나온다.  

#### 3-2-2 라즈베리파이 환경 설정  
* RASPI-CONFIG 메뉴에서 A버튼(조이스틱 버튼)을 눌러준다.  
* RASPI-CONFIG 메뉴에 들어간 후 1번 메뉴를 선택을 하는데 여기서 조이스틱의 좌/우를 활용하여 창의 아래쪽 하단에 <Select>/<Finish>를 선택할 수 있다.  
(여기서부터는 키보드 조작이 편리합니다.)  
* 1번 메뉴를 선택한 후 실행을 해주게 되면 SD Card의 전체 용량을 확장해준다.  
* esc(키보드)를 누른 후 RASPI-CONFIG 메뉴에서 2번 메뉴에서 A버튼을 누른 다음에 ok버튼에서 Enter(키보드)를 누른다.  
* Enter를 누른 후 아래쪽 하단에 비밀번호를 설정할 수 있는 창이 나와서 비밀번호를 설정한다.  
-> 조하롭게 팀은 raspberry로 설정을 하였다.  
* 설정을 한 후 RASPI-CONFIG에 다시 들어간다.  
* RASPI-CONFIG 메뉴에 4번을 선택하여 실행을 하게 되면 지역과 시간 설정이 가능하다.  
* 방향키(키보드)로 아래 키를 누르면서 Asia에서 Enter을 누른다.  
* 이후 키보드 S키를 누르면 S 부분으로 넘어간다. S버튼을 누른 후 방향키 아래 키를 눌러 Seoul로 설정을 한다.  
* 지역 설정이 마무리되면 esc로 다시 설정 화면으로 나가준다.  
* RASPI-CONFIG 메뉴에 들어가서 5번 목록(Interfacing Options)을 A버튼(조이스틱) 또는 Enter(키보드)버튼을 눌러서 들어간다.  
* Interfacing Options에 들어가면 두 번째 메뉴인 SSH에서 Enter(키보드)를 눌러 Yes로 변경하여 Enable 상태로 변경을 해준다.   
  (외부 원격 접속 허용방법)  
  
#### 3-2-3 와이파이 설정  
* 설정에 WIFI(가장 하단)에서 A버튼(조이스틱)을 눌러 들어간다.  
* 1번을 선택한 후 A버튼(조이스틱)을 눌러 줍니다.  
* 사용 가능한 와이파이 목록이 여러 개가 나오는데 사용하는 와이파이를 조이스틱 또는 키보드 방향키로 조작을 한 후 Enter키를 누른다.  
* 공유기의 비밀번호를 묻는 화면이 나오면 공유기의 비밀번호를 입력한다.  
* 와이파이를 연결한 후 초기 화면인 설정화면으로 나가줍니다.  

#### 3-2-4 레트로파이 설정  
* 초기 설정 화면에 들어간 후 RETROPIE SETUP에 들어간다.  
* 3가지 업데이트를 한다. (인터넷(랜선/와이파이)이 연결되어 있는지 확인한다.)  
* 처음 Basic Install에서 Enter를 누르게 되면 업데이트가 진행된다.( 대략 5분소요)  
* 5번째 Update RetroPie-Setup script에서 Enter를 누르게 되면 업데이트가 진행된다.(대략 1분소요)  
* 2번째 Update all installed packages에서 Enter를 누르게 되면 업데이트가 진행된다.(대략 20~30분소요)  
* 업데이트가 마무리되면 조이스틱이 작동하지 않을 수가 있다.  
-> 조하롭게 팀은 조이스틱이 작동하지 않았었다.  
* 만약 작동하지 않을 경우 F4를 눌러 리눅스 화면으로 들어가진다.  
> mv opt/ retropie/ configs/ all/ emulationstation/ es_input.cfg/ opt/ retrofie/ configs/ all/ emulationstation/ es_input.cfg.bak <Enter>  
> sudo/home/pi/RetroPie-Setup/retropie_packages.sh emulationstation configure <Enter>  
> emulationstation <Enter>  
* 조이스틱 설정창이 뜨게 되면 다시 조이스틱 키를 이전과 동일하게 맞춘다.  

## 4. 레트로 파이에 게임 넣기  
* 레트로 파이 설정 초기화면에서 SHOW IP를 A버튼(조이스틱)을 이용해 접속한다.  
* 현재 레트로 파이에 설정 되어있는 IP의 주소를 확인한다.  
* 노트북 또는 데스크 탑을 킨다.  
-> 조하롭게 팀은 노트북을 사용했기 때문에 노트북이라고 말을 할 예정이다.  
* 노트북에서 https://filezilla-project.org/ 에 들어가서 파일질라 클라이언트를 다운 받는다.  
* 파일질라를 다운 받은 후 파일질라를 실행시켜 준다.  
* 파일질라를 실행 시킨 후 호스트명에 레트로 파이에서 확인한 IP주소를 적어준다.  
* 사용자명과 비밀번호는 레트로 파이 설정 때 설정했던 아이디와 비밀번호를 입력한다.  
-> 조하롭게 팀은 아이디: pi, 비밀번호: raspberry로 하였다. (별도의 설정을 하지 않는 경우에도 아이디: pi, 비밀번호: raspberry로 되어있다.)  
* 파일질라를 통해서 레트로 파이와 연결이 되면 노트북에서 게임파일을 다운로드해준다. (게임파일이 안 되는 것들이 상당히 많다.)  
* http://www.ankman.de/mame/ 에서 원하는 게임파일은 다운받는다.  
* 다운받은 게임들은 마메 에뮬레이터에서 받은 것이기 때문에 파일을 마메 파일에 넣어 주어야한다.  
* 다시 파일질라에 들어가서 레트로 파이의 파일을 들어가 준다.  
* RETROPI-> roms-> mame-libretro 에 노트북에 다운받았던 게임파일들을 넣어준다.  

## 5. 게임 실행하기  
* 레트로 파이를 reboot를 해준다. (F4를 눌러 reboot을 입력하면 된다.)  
* 레트로 파이 처음 실행 화면에 MAME라고 되어있는 화면이 있다.  
* MAME라는 화면에 들어가서 넣었던 게임 파일의 게임을 실행하면 된다.  
* 게임을 실행할 때 게임 내에서 키를 설정하는 화면이 나오는데 A버튼을 누르면 게임 중에 원하거나 필요한 키 설정이 가능하다.  
(이 설정 화면에서 Error이라는 글귀가 나오는데 Error가 발생할 경우 Error의 내용을 주어진 파일 경로에 저장한다는 말이므로 크게 신경을 쓰지 않아도 된다.)  

## 6. 라즈베리파이 정상 작동 확인 여부  
* 라즈베리파이, 브레드보드, LED*2, 점퍼와이어*3(암수*1, 암암*2), 220Ω저항*2을 준비한다.  
* 라즈베리파이의 물리 핀 2번, 4번에 연결을 한다.(두 핀 모두 5V 전원 공급을 하는 핀이기 때문에 라즈베리파이에 전원이 들어왔는지 확인이 가능하다.)  
* 물리 핀 2번, 4번에 연결한 암암 점퍼 선들을 브레드 보드에 배치시킨다.   
* 물리 핀 5번은 그라운드이기 때문에 브레드 보드의 마이너스 부분에 암수 점퍼 선을 연결한다.  
* 저항 2개를 마이너스가 흐르는 브레드 보드에 연결을 한다.  
* 마이너스(-)가 흐르는 저항 2개를 LED의 마이너스(-)에 연결한다.(led는 선이 짧은 쪽이 마이너스(-)이다.)  
* 플러스(+)에 연결한 암암 점퍼 선을 led의 플러스(+)에 연결한다.(led는 선이 긴 쪽이 플러스(+)이다.)  
* 라즈베리파이의 전원 공급을 하여 led의 빛이 들어오는지 확인한다.  
